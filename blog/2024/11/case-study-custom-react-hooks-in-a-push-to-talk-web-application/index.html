<!DOCTYPE html><html lang="en" data-astro-transition-scope="astro-ouwq6jio-1"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="text/partytown" async src="https://www.googletagmanager.com/gtag/js?id=G-ZCBEYF2WZJ"></script><script type="text/partytown">(function(){const MID = "G-ZCBEYF2WZJ";

  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', MID);
})();</script><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.13.3"><meta name="theme-color" content="#000000"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet"><meta name="color-scheme" content="light"><title>Case Study: Custom React Hooks in a Push-to-Talk (PTT) Web Application | Richard&#39;s Blog</title><meta name="title" content="Case Study: Custom React Hooks in a Push-to-Talk (PTT) Web Application | Richard's Blog"><meta name="description" content="Recently, I had a school project. In the project, we are supposed to create a push-to-talk web application. The sender will stream their audio via a WebSockets connection to a server, which will relay the audio to the listener. Not only that, we had to use the Web Audio API to process the audio data on the sender and listener's devices. This meant that there was a high chance of coupling, not only between the UI component and application logic, but especially between the audio processing logic and the WebSocket streaming logic. Thus, in order to make it reusable, I wanted to enforce some separation of concerns from the get-go. It was decided: they will become custom React hooks.
"><meta property="og:type" content="website"><meta property="og:url" content="https://richarddominick.me/blog/2024/11/case-study-custom-react-hooks-in-a-push-to-talk-web-application/"><meta property="og:title" content="Case Study: Custom React Hooks in a Push-to-Talk (PTT) Web Application | Richard's Blog"><meta property="og:description" content="Recently, I had a school project. In the project, we are supposed to create a push-to-talk web application. The sender will stream their audio via a WebSockets connection to a server, which will relay the audio to the listener. Not only that, we had to use the Web Audio API to process the audio data on the sender and listener's devices. This meant that there was a high chance of coupling, not only between the UI component and application logic, but especially between the audio processing logic and the WebSocket streaming logic. Thus, in order to make it reusable, I wanted to enforce some separation of concerns from the get-go. It was decided: they will become custom React hooks.
"><meta property="twitter:card" content="summary"><meta property="twitter:url" content="https://richarddominick.me/blog/2024/11/case-study-custom-react-hooks-in-a-push-to-talk-web-application/"><meta property="twitter:title" content="Case Study: Custom React Hooks in a Push-to-Talk (PTT) Web Application | Richard's Blog"><meta property="twitter:description" content="Recently, I had a school project. In the project, we are supposed to create a push-to-talk web application. The sender will stream their audio via a WebSockets connection to a server, which will relay the audio to the listener. Not only that, we had to use the Web Audio API to process the audio data on the sender and listener's devices. This meant that there was a high chance of coupling, not only between the UI component and application logic, but especially between the audio processing logic and the WebSocket streaming logic. Thus, in order to make it reusable, I wanted to enforce some separation of concerns from the get-go. It was decided: they will become custom React hooks.
"><link rel="stylesheet" href="/_astro/_slug_.Bk4Rkpmd.css">
<link rel="stylesheet" href="/_astro/_slug_.B_DnfVK7.css"><script type="module" src="/_astro/hoisted.txRvgxej.js"></script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.10.2 - MIT builder.io */
const t={preserveBehavior:!1},e=e=>{if("string"==typeof e)return[e,t];const[n,r=t]=e;return[n,{...t,...r}]},n=Object.freeze((t=>{const e=new Set;let n=[];do{Object.getOwnPropertyNames(n).forEach((t=>{"function"==typeof n[t]&&e.add(t)}))}while((n=Object.getPrototypeOf(n))!==Object.prototype);return Array.from(e)})());!function(t,r,o,i,a,s,c,d,l,p,u=t,f){function h(){f||(f=1,"/"==(c=(s.lib||"/~partytown/")+(s.debug?"debug/":""))[0]&&(l=r.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(v,1e4),r.addEventListener("pt0",w),a?y(1):o.serviceWorker?o.serviceWorker.register(c+(s.swPath||"partytown-sw.js"),{scope:c}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):v())))}function y(e){p=r.createElement(e?"script":"iframe"),t._pttab=Date.now(),e||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=c+"partytown-"+(e?"atomics.js?v=0.10.2":"sandbox-sw.html?"+t._pttab),r.querySelector(s.sandboxParent||"body").appendChild(p)}function v(n,o){for(w(),i==t&&(s.forward||[]).map((function(n){const[r]=e(n);delete t[r.split(".")[0]]})),n=0;n<l.length;n++)(o=r.createElement("script")).innerHTML=l[n].innerHTML,o.nonce=s.nonce,r.head.appendChild(o);p&&p.parentNode.removeChild(p)}function w(){clearTimeout(d)}s=t.partytown||{},i==t&&(s.forward||[]).map((function(r){const[o,{preserveBehavior:i}]=e(r);u=t,o.split(".").map((function(e,r,o){var a;u=u[o[r]]=r+1<o.length?u[o[r]]||(a=o[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(i){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,o);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(o,arguments),n}})()}))})),"complete"==r.readyState?h():(t.addEventListener("DOMContentLoaded",h),t.addEventListener("load",h))}(window,document,navigator,top,window.crossOriginIsolated);;(e=>{e.addEventListener("astro:before-swap",e=>{let r=document.body.querySelector("iframe[src*='/~partytown/']");if(r)e.newDocument.body.append(r)})})(document);</script><style>[data-astro-transition-scope="astro-ouwq6jio-1"] { view-transition-name: astro-ouwq6jio-1; }@layer astro { ::view-transition-old(astro-ouwq6jio-1) { animation: none; opacity: 0; mix-blend-mode: normal; }::view-transition-new(astro-ouwq6jio-1) { animation: none; mix-blend-mode: normal; }::view-transition-group(astro-ouwq6jio-1) { animation: none } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-ouwq6jio-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-ouwq6jio-1"] { animation: none; mix-blend-mode: normal; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-ouwq6jio-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-ouwq6jio-1"] { animation: none; mix-blend-mode: normal; }</style></head> <body class="light"> <div id="root"> <div class="BACKGROUND_DYNAMIC_COLOR TEXT_DYNAMIC_COLOR"> <header class="header BACKGROUND_DYNAMIC_COLOR TEXT_DYNAMIC_COLOR !bg-opacity-70 dark:!bg-opacity-50 backdrop-blur sticky top-0 w-full h-[--header-height] flex items-center gap-x-1 md:gap-x-5 lg:gap-x-6 px-3 md:px-5 py-4 text-sm font-display justify-end TEXT_MEDIUM z-10"> <div class="text-xl grow flex"> <div class="text-center"> <a id="site-logo" href="/" class="text-stone-500 hover:text-black dark:text-stone-400 dark:hover:text-stone-300 select-none inline-block w-[2.0625rem] md:w-[2.5rem] font-normal hover:font-black transition-[color,font-weight]">
RD
</a> </div>  </div> <a class="px-2 py-1 transition select-none rounded hover:shadow-md hover:text-white dark:hover:text-stone-900 hover:bg-blue-600 dark:hover:bg-zinc-100" href="/experiments" title="Experiments">  Experiments  </a> <a class="px-2 py-1 transition select-none rounded hover:shadow-md hover:text-white dark:hover:text-stone-900 hover:bg-blue-600 dark:hover:bg-zinc-100 text-stone-900 dark:text-stone-200 bg-zinc-200 dark:bg-zinc-600 bg-opacity-95 dark:bg-opacity-90 shadow-none" href="/blog" title="Blog">  Blog  </a> <a class="px-2 py-1 transition select-none rounded hover:shadow-md hover:text-white dark:hover:text-stone-900 hover:bg-blue-600 dark:hover:bg-zinc-100" href="https://github.com/RichDom2185" title="GitHub" target="_blank">  GitHub <iconify-icon inline="true" icon="heroicons-outline:external-link"></iconify-icon> </a>  </header>  <main> <div class="post max-w-4xl mx-auto px-6 lg:px-0 space-y-2 TEXT_NORMAL">  <h1 class="text-2xl md:text-3xl lg:text-4xl TEXT_BOLD !my-7 !leading-tight"> Case Study: Custom React Hooks in a Push-to-Talk (PTT) Web Application </h1> <span class="italic uppercase"> <time datetime="2024-11-02T00:00:00.000Z">Saturday, 2 Nov 2024</time> </span> <div class="flex flex-wrap gap-2 items-center"> <span>Author:</span> <ul class="post-author flex gap-2 flex-wrap"> <li class="bg-gray-100 dark:bg-gray-700 dark:text-stone-300 px-2 py-0.5 rounded-lg"> <iconify-icon inline="true" icon="emojione:bust-in-silhouette"></iconify-icon> Richard Dominick </li> </ul> </div> <hr class="!my-4 dark:border-[color:unset]"> <div class="flex"> <div class="flex justify-start items-center group/share gap-x-0 hover:gap-x-3 hover:md:gap-x-4"> <span class="opacity-60 dark:opacity-90 group-hover/share:opacity-100"> <iconify-icon inline="true" icon="heroicons:share-16-solid"></iconify-icon> <span>Share</span> </span> <button class="overflow-x-hidden group-hover/share:overflow-x-visible transition-all w-0 group-hover/share:w-auto opacity-0 group-hover/share:opacity-100 text-2xl relative group"> <a class="hover:text-[#2AABEE]" href="https://t.me/share/url?text=Check%20out%20this%20post%3A%20Case%20Study%3A%20Custom%20React%20Hooks%20in%20a%20Push-to-Talk%20(PTT)%20Web%20Application&url=https%3A%2F%2Fricharddominick.me%2Fblog%2F2024%2F11%2Fcase-study-custom-react-hooks-in-a-push-to-talk-web-application" target="_blank" rel="noopener noreferrer nofollow"><span class="underline decoration-dotted hover:decoration-solid underline-offset-4"><span class="sr-only">Share this post on Telegram</span><iconify-icon inline="true" icon="ri:telegram-2-fill"></iconify-icon> </span></a> <span class="select-none box-border py-[6px] px-[8px] bg-black rounded-[6px] text-white text-xs not-italic text-center w-fit absolute z-50 top-full left-1/2 -translate-x-1/2 mt-1 invisible opacity-0 transition-opacity duration-50 group-hover:opacity-100 group-hover:visible"> Telegram </span> </button><button class="overflow-x-hidden group-hover/share:overflow-x-visible transition-all w-0 group-hover/share:w-auto opacity-0 group-hover/share:opacity-100 text-2xl relative group"> <a class="hover:text-[#24D366]" href="https://api.whatsapp.com/send/?text=https%3A%2F%2Fricharddominick.me%2Fblog%2F2024%2F11%2Fcase-study-custom-react-hooks-in-a-push-to-talk-web-application&type=custom_url&app_absent=0" target="_blank" rel="noopener noreferrer nofollow"><span class="underline decoration-dotted hover:decoration-solid underline-offset-4"><span class="sr-only">Share this post on WhatsApp</span><iconify-icon inline="true" icon="ri:whatsapp-line"></iconify-icon> </span></a> <span class="select-none box-border py-[6px] px-[8px] bg-black rounded-[6px] text-white text-xs not-italic text-center w-fit absolute z-50 top-full left-1/2 -translate-x-1/2 mt-1 invisible opacity-0 transition-opacity duration-50 group-hover:opacity-100 group-hover:visible"> WhatsApp </span> </button><button class="overflow-x-hidden group-hover/share:overflow-x-visible transition-all w-0 group-hover/share:w-auto opacity-0 group-hover/share:opacity-100 text-2xl relative group"> <a class="hover:text-[#0B66C2]" href="https://www.linkedin.com/sharing/share-offsite?url=https%3A%2F%2Fricharddominick.me%2Fblog%2F2024%2F11%2Fcase-study-custom-react-hooks-in-a-push-to-talk-web-application" target="_blank" rel="noopener noreferrer nofollow"><span class="underline decoration-dotted hover:decoration-solid underline-offset-4"><span class="sr-only">Share this post on LinkedIn</span><iconify-icon inline="true" icon="ri:linkedin-box-line"></iconify-icon> </span></a> <span class="select-none box-border py-[6px] px-[8px] bg-black rounded-[6px] text-white text-xs not-italic text-center w-fit absolute z-50 top-full left-1/2 -translate-x-1/2 mt-1 invisible opacity-0 transition-opacity duration-50 group-hover:opacity-100 group-hover:visible"> LinkedIn </span> </button><button class="overflow-x-hidden group-hover/share:overflow-x-visible transition-all w-0 group-hover/share:w-auto opacity-0 group-hover/share:opacity-100 text-2xl relative group"> <a class="hover:text-[#1877F2]" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fricharddominick.me%2Fblog%2F2024%2F11%2Fcase-study-custom-react-hooks-in-a-push-to-talk-web-application" target="_blank" rel="noopener noreferrer nofollow"><span class="underline decoration-dotted hover:decoration-solid underline-offset-4"><span class="sr-only">Share this post on Facebook</span><iconify-icon inline="true" icon="ri:facebook-circle-fill"></iconify-icon> </span></a> <span class="select-none box-border py-[6px] px-[8px] bg-black rounded-[6px] text-white text-xs not-italic text-center w-fit absolute z-50 top-full left-1/2 -translate-x-1/2 mt-1 invisible opacity-0 transition-opacity duration-50 group-hover:opacity-100 group-hover:visible"> Facebook </span> </button><button class="overflow-x-hidden group-hover/share:overflow-x-visible transition-all w-0 group-hover/share:w-auto opacity-0 group-hover/share:opacity-100 text-2xl relative group"> <a class="hover:text-[#198CD8]" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fricharddominick.me%2Fblog%2F2024%2F11%2Fcase-study-custom-react-hooks-in-a-push-to-talk-web-application&text=Check%20out%20this%20post%3A%20Case%20Study%3A%20Custom%20React%20Hooks%20in%20a%20Push-to-Talk%20(PTT)%20Web%20Application" target="_blank" rel="noopener noreferrer nofollow"><span class="underline decoration-dotted hover:decoration-solid underline-offset-4"><span class="sr-only">Share this post on Twitter</span><iconify-icon inline="true" icon="ri:twitter-x-fill"></iconify-icon> </span></a> <span class="select-none box-border py-[6px] px-[8px] bg-black rounded-[6px] text-white text-xs not-italic text-center w-fit absolute z-50 top-full left-1/2 -translate-x-1/2 mt-1 invisible opacity-0 transition-opacity duration-50 group-hover:opacity-100 group-hover:visible"> Twitter </span> </button> </div> </div> <hr class="!my-4 dark:border-[color:unset]">  <span class="italic text-xs block text-stone-600 uppercase">
Last Updated on
<time datetime="2024-11-06T00:00:00.000Z">Wednesday, 6 Nov 2024</time> </span> <hr class="!my-4">  <article class="space-y-4 leading-relaxed text-justify [&#38;_code]:text-[0.9em] [&#38;_pre>code]:text-[0.875em] [&#38;_:is(h1,h2,h3,h4,h5,h6)_code]:text-[length:unset]">  <p class="scroll-mt-[--header-height] TEXT_NORMAL">Recently, I had a school project. In the project, we are supposed to create a push-to-talk web application. The sender will stream their audio via a WebSockets connection to a server, which will relay the audio to the listener. Not only that, we had to use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API" target="_blank" rel="noopener noreferrer" class="hover:underline hover:decoration-dashed underline-offset-4 LINK_DYNAMIC_NO_HOVER">Web Audio API</a> to process the audio data on the sender and listener’s devices. This meant that there was a high chance of coupling, not only between the UI component and application logic, but especially between the audio processing logic and the WebSocket streaming logic. Thus, in order to make it reusable, I wanted to enforce some separation of concerns from the get-go. It was decided: they will become custom React hooks.</p>
<h2 id="what-is-coupling" class="scroll-mt-[--header-height] font-display text-left group TEXT_MEDIUM relative cursor-pointer hover:underline underline-offset-8 decoration-dashed text-lg lg:text-xl"><a href="#what-is-coupling">What is Coupling<span class="inline-block ml-1 text-sm opacity-0 group-hover:opacity-100 LINK_DYNAMIC_NO_HOVER">#</span></a></h2>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">Coupling is a term used in software engineering to describe how much one part of a system relies on another part. In general, the less coupling there is between different parts of a system, the easier it is to maintain and extend that system. You can find more information about coupling in <a href="https://se-education.org/se-book/designFundamentals/coupling/index.html#coupling" target="_blank" rel="noopener noreferrer" class="hover:underline hover:decoration-dashed underline-offset-4 LINK_DYNAMIC_NO_HOVER">this SE-EDU textbook</a>. In practice, I often find its most common symptom: functions or components that are “doing more than one thing”.</p>
<h2 id="coupling-in-a-push-to-talk-web-application" class="scroll-mt-[--header-height] font-display text-left group TEXT_MEDIUM relative cursor-pointer hover:underline underline-offset-8 decoration-dashed text-lg lg:text-xl"><a href="#coupling-in-a-push-to-talk-web-application">Coupling in a Push-to-Talk Web Application<span class="inline-block ml-1 text-sm opacity-0 group-hover:opacity-100 LINK_DYNAMIC_NO_HOVER">#</span></a></h2>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">We are using React for our project. Generally, using React already enforces some kind of separation of concerns. In most tutorials or examples, you will see that the UI logic is separated from the application logic. This is usually done by separating the application logic like data fetching, or state management, into functions or <a href="https://react.dev/reference/react/hooks" target="_blank" rel="noopener noreferrer" class="hover:underline hover:decoration-dashed underline-offset-4 LINK_DYNAMIC_NO_HOVER">hooks</a>.</p>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">The problem comes when the application logic itself involves multiple components that are not necessarily related to each other. For example, in our push-to-talk application, the audio processing logic and the WebSocket streaming logic are always used together in the same component. Moreover, being native browser JavaScript APIs, there is not much flexibility in fitting the code to suit React’s declarative-style programming.</p>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">These make it tempting to combine the two logics into one function or hook. In fact, I must say, it is much easier to do so. Just for fun, I tried feeding the requirements into various LLMs and they are not able to come up with a working solution, even after a lot of hinting.</p>
<h3 id="premature-optimization-a-design-decision" class="scroll-mt-[--header-height] font-display text-left group TEXT_MEDIUM relative cursor-pointer hover:underline underline-offset-8 decoration-dashed text-lg"><a href="#premature-optimization-a-design-decision">Premature Optimization: A Design Decision<span class="inline-block ml-1 text-sm opacity-0 group-hover:opacity-100 LINK_DYNAMIC_NO_HOVER">#</span></a></h3>
<blockquote class="scroll-mt-[--header-height] TEXT_NORMAL space-y-4 pl-4 border-l-4 border-dashed BORDER_DYNAMIC_COLOR">
<p><em>But wait, why is it bad to combine the two logics into one function or hook? Aren’t we always using the two together? Premature optimization is bad, right?</em></p>
</blockquote>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">I agree that premature optimization is not always the best thing to do, and it really depends on the context of your use case. Arguably, with the age of LLMs that can (most of the time) write code as instructed, the ability to design and architect software and write good code is becoming more important. It involves analyzing your use case and making decisions like these, that may not always have a clear answer.</p>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">In our case, we had to implement a collision-control mechanism as part of the project requirements. This means only one person can speak at a time, similar to how conference room microphones work.</p>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">We handle this by using a centralized server to manage clients, and RTS/CTS (Request to Send/Clear to Send) messages. Naturally, the audio processing logic does not need to know about this. It only needs to know when to start and stop processing audio data; only the WebSocket streaming logic needs to know about the collision-control mechanism that is in-play.</p>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">That was a sign to me to start to enforce the abstraction early. As the project grew, the collision control mechanism was not the only WebSocket-specific logic that was added. We also added metadata messages like sender information, and a way to send messages to the server. Luckily, our abstraction was already in place, so implementing these were relatively simple.</p>
<h2 id="react-hooks-implementation" class="scroll-mt-[--header-height] font-display text-left group TEXT_MEDIUM relative cursor-pointer hover:underline underline-offset-8 decoration-dashed text-lg lg:text-xl"><a href="#react-hooks-implementation">React Hooks Implementation<span class="inline-block ml-1 text-sm opacity-0 group-hover:opacity-100 LINK_DYNAMIC_NO_HOVER">#</span></a></h2>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">It might be best to jump straight to the code and see it in action. Our custom <code class="bg-gray-200 dark:bg-gray-800 px-1 py-0.5 rounded-sm">useStreaming</code> hook is as follows:</p>
<div class="highlight bg-[#f8f8f8] dark:bg-[#24292f] mx-0 my-[1em] rounded language-tsx scroll-mt-[--header-height] TEXT_NORMAL"><pre class="astro-code astro-code-themes github-light github-dark highlight bg-[#f8f8f8] dark:bg-[#24292f] mx-0 my-[1em] rounded overflow-x-auto px-6 py-4" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e; overflow-x: auto;" tabindex="0" data-language="tsx"><code><span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> { useCallback, useEffect, useState } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'react'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> StreamingState</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'off'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'on'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'waiting'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useStreaming</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">wsEndpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">&#x3C;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">StreamingState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">>(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85">'off'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">wsClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">setWsClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">&#x3C;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">WebSocket</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">>(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> WebSocket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(wsEndpoint);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D" class="dark:opacity-85">    // Add more event listeners here as needed...</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D" class="dark:opacity-85">    // client.onopen = ...</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D" class="dark:opacity-85">    // client.onclose = ...</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'CTS'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">        setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'on'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      }</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    };</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">    setWsClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(client);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">();</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">      setWsClient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    };</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  }, [wsEndpoint]);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> rawSend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (wsClient?.readyState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">===</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> WebSocket.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">OPEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">        wsClient.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(data);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      }</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    },</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    [wsClient],</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  );</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> send</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'on'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D" class="dark:opacity-85">        // Don't send packets before CTS is received</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      }</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">      rawSend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(data);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    },</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    [rawSend, state],</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  );</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> beginStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">    setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'waiting'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">    rawSend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85">`RTS$`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  }, [rawSend]);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> endStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">    rawSend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85">'STOP'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">    setState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'off'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  }, [rawSend]);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> { state, send, beginStream, endStream };</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">};</span></span>
<span class="line dark:opacity-85"></span></code></pre></div>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">Meanwhile, our custom <code class="bg-gray-200 dark:bg-gray-800 px-1 py-0.5 rounded-sm">useAudioRecording</code> hook is as follows:</p>
<div class="highlight bg-[#f8f8f8] dark:bg-[#24292f] mx-0 my-[1em] rounded language-tsx scroll-mt-[--header-height] TEXT_NORMAL"><pre class="astro-code astro-code-themes github-light github-dark highlight bg-[#f8f8f8] dark:bg-[#24292f] mx-0 my-[1em] rounded overflow-x-auto px-6 py-4" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e; overflow-x: auto;" tabindex="0" data-language="tsx"><code><span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> { useCallback, useEffect, useState } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'react'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> MIMETYPE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'audio/webm; codecs=opus'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> getAudioStream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  navigator.mediaDevices.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">getUserMedia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">({ audio: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> });</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> AudioRecordingOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">  onData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">};</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useAudioRecording</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">onData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> AudioRecordingOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">mediaRecorder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">setMediaRecorder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">&#x3C;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">MediaRecorder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">>(</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">    null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">,</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  );</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">mediaRecorder) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    }</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">    const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> handleData</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> BlobEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (event.data.size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">></span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">        onData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(event.data);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      }</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    };</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    mediaRecorder.ondataavailable </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> handleData;</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  }, [mediaRecorder, onData]);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> startRecording</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> stream</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> getAudioStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">();</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> recorder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> MediaRecorder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(stream, { mimeType: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">MIMETYPE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> });</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">      setMediaRecorder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(recorder);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      recorder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D" class="dark:opacity-85">// Send data every 100ms</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (error) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85">'Error accessing microphone:'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, error);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    }</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  }, []);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> stopRecording</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (mediaRecorder?.state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'recording'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      mediaRecorder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">();</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    }</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    mediaRecorder?.stream.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">getTracks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70" class="dark:opacity-85">t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> t.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">());</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  }, [mediaRecorder]);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> { start: startRecording, stop: stopRecording };</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">};</span></span>
<span class="line dark:opacity-85"></span></code></pre></div>
<p class="scroll-mt-[--header-height] TEXT_NORMAL"><em>Phew, those were quite some long hooks! Credit goes to <a href="https://www.cybrosys.com/blog/how-to-implement-audio-recording-in-a-react-application" target="_blank" rel="noopener noreferrer" class="hover:underline hover:decoration-dashed underline-offset-4 LINK_DYNAMIC_NO_HOVER">this blog post</a> for the initial setup on getting Web Audio API to work in a React application, which I heavily adapted into a custom hook for better separation of concerns from the actual UI component.</em></p>
<h2 id="usage" class="scroll-mt-[--header-height] font-display text-left group TEXT_MEDIUM relative cursor-pointer hover:underline underline-offset-8 decoration-dashed text-lg lg:text-xl"><a href="#usage">Usage<span class="inline-block ml-1 text-sm opacity-0 group-hover:opacity-100 LINK_DYNAMIC_NO_HOVER">#</span></a></h2>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">Now that we have our custom hooks, we can use them in our components like so:</p>
<div class="highlight bg-[#f8f8f8] dark:bg-[#24292f] mx-0 my-[1em] rounded language-tsx scroll-mt-[--header-height] TEXT_NORMAL"><pre class="astro-code astro-code-themes github-light github-dark highlight bg-[#f8f8f8] dark:bg-[#24292f] mx-0 my-[1em] rounded overflow-x-auto px-6 py-4" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e; overflow-x: auto;" tabindex="0" data-language="tsx"><code><span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85"> wsEndpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'ws://your-ws-server-endpoint'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">;</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> Room</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> React</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">FC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">send</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">beginStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">endStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useStreaming</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(wsEndpoint);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useAudioRecording</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">({ onData: send });</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">transmitting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">setTransmitting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">  useEffect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (transmitting </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">&#x26;&#x26;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'on'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">) {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">      start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">();</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">      stop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">();</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    }</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  }, [state, transmitting]);</span></span>
<span class="line dark:opacity-85"></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> (</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    &#x3C;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      &#x3C;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">button</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">        onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">{() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">          beginStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">();</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">          setTransmitting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">        }}</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      ></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">        Start Transmission</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      &#x3C;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      &#x3C;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">button</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">        onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">{() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85"> {</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">          endStream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">();</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">          setTransmitting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF" class="dark:opacity-85">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">);</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">        }}</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      ></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">        Stop Transmission</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      &#x3C;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      &#x3C;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">p</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">        className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0" class="dark:opacity-85">clsx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">(</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">          state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'on'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> &#x26;&#x26;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'bg-green-500'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">,</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">          state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'waiting'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> &#x26;&#x26;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'bg-orange-500'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">,</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">          state </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'off'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583" class="dark:opacity-85"> &#x26;&#x26;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF" class="dark:opacity-85"> 'bg-blue-500'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">,</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">        )}</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      ></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">        Status: {state}</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">      &#x3C;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">    &#x3C;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D" class="dark:opacity-85">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">></span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">  );</span></span>
<span class="line dark:opacity-85"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8" class="dark:opacity-85">};</span></span>
<span class="line dark:opacity-85"></span></code></pre></div>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">Now, the UI component only needs to know about the <code class="bg-gray-200 dark:bg-gray-800 px-1 py-0.5 rounded-sm">useStreaming</code> and <code class="bg-gray-200 dark:bg-gray-800 px-1 py-0.5 rounded-sm">useAudioRecording</code> hooks. It does not need to know about the WebSocket or Web Audio API at all. This makes it easier to test and maintain the UI component, as well as the hooks themselves. Not only does it become easier to read, but we can change the internals of the hooks without having to worry about the UI component at all!</p>
<h2 id="conclusion" class="scroll-mt-[--header-height] font-display text-left group TEXT_MEDIUM relative cursor-pointer hover:underline underline-offset-8 decoration-dashed text-lg lg:text-xl"><a href="#conclusion">Conclusion<span class="inline-block ml-1 text-sm opacity-0 group-hover:opacity-100 LINK_DYNAMIC_NO_HOVER">#</span></a></h2>
<p class="scroll-mt-[--header-height] TEXT_NORMAL">In this article, we use a case study of a push-to=talk web application to discuss the importance of separation of concerns in software engineering. We saw we can enforce such principles in React using custom hooks in our application. By creating custom hooks for the WebSocket and Web Audio API logic, we were able to keep our UI component clean and maintainable, and make our application more flexible and reusable. Of course, this is just one case study, and there are many other ways to enforce separation of concerns in your applications, each with its own trade-offs. What works best for you will depend on your use case and your team’s preferences. But I hope this article has given you some ideas on how you can use custom hooks to enforce separation of concerns in your own applications.</p>
<hr class="scroll-mt-[--header-height] TEXT_NORMAL dark:border-[color:unset]">
<p class="scroll-mt-[--header-height] TEXT_NORMAL"><em>Stay tuned for more writeups on tech!</em></p>  </article> </div> </main> <footer class="text-center px-4 pt-8 pb-12 md:pb-24">
&copy; 2024 Richard Dominick. All rights reserved.
<div class="flex justify-center gap-4 mt-4"> <a href="https://www.linkedin.com/in/richard-dominick" target="_blank"> <span class="sr-only">Connect with me on LinkedIn</span> <iconify-icon class="text-[2rem]" icon="cib:linkedin"></iconify-icon> </a> <a href="mailto:richard.dominick01@gmail.com" target="_blank"> <span class="sr-only">Send me an email</span> <iconify-icon class="text-[2rem]" icon="cib:gmail"></iconify-icon> </a> <a href="https://github.com/RichDom2185" target="_blank"> <span class="sr-only">Go to my GitHub profile</span> <iconify-icon class="text-[2rem]" icon="cib:github"></iconify-icon> </a> </div> </footer> </div> </div> </body></html>